<script type="text/babel">
  $(document)
    .ready(function () {
      formValidation()
      loadAcademicProgramsAndFaculties()
      $('.ui.radio.checkbox').checkbox()
      $('select.dropdown').dropdown()
      // $('.submit').on('click',function(event){
      //     event.preventDefault()
      //     $('.ui.form').serializa
  
      // })
    })
  


  function validationpassed(e) {
    e.preventDefault()
    var mForm = $('.ui.form')
    var formData = mForm.serializeArray()
  
    function onSuccess(person) {
      console.log('A nice formatted person', person)
    }
  
    console.log(formData)
    google.script.run.withSuccessHandler(onSuccess).registerPerson(formData)
  }
  
  function searchForPerson() {
    // $('#btn-search').removeClass('icon')
    $('#btn-search').addClass('loading')
    hideForm()
    function onSuccess(person) {
      console.log('A nice formatted person', person)
      showForm()
      $('#btn-search').removeClass('loading')
      if (person.isRegistered) {
        loadPersonInForm(person)
      }else{
        var sraPerson = searchPersonInSRA()
        if(sraPerson){
          loadSRAPersonInForm(sraPerson)
        }
      }
    }

    var cedula = $('#cedula').val()
    google.script.run.withSuccessHandler(onSuccess).searchPerson(cedula)
  }

  function disableFormFielfds(bool){
    if(bool){
      $("input").prop('disabled', true)
    }else{
      $("input").prop('disabled', false)

    }
  } 

  function loadSRAPersonInForm(person){
    console.log('Person in form', person)

    $("input[name='nombres']").val(person.data.nombre)
    $("input[name='apellidos']").val(person.data.apellido)
    $("input[name='cedula']").val(person.data.cedula)

    $("input[name='programa']").val(person.data.programa)
    $("input[name='facultad']").val(person.data.facultad)

  }
  
  function loadPersonInForm(person) {
    console.log('Person in form', person)

    $("input[name='nombres']").val(person.data.nombre)
    $("input[name='apellidos']").val(person.data.apellido)
    $("input[name='cedula']").val(person.data.cedula)
    $("input[name='email']").val(person.data.correo)
    $("input[name='celular']").val(person.data.celular)
    $("input[name='programa']").val(person.data.programa)
    $("input[name='facultad']").val(person.data.facultad)

    disableFormFielfds(true)
  }
  
  
  function showForm() {
    $('#mainForm').css('display', 'inline-block')
    disableFormFielfds(false)
  }
  
  function hideForm() {
    $('#mainForm').css('display', 'none')
    disableFormFielfds(false)
    $('.ui.form').form('clear')
  
  }
  function loadAcademicProgramsAndFaculties() {
  
    function onSuccess(result) {
      console.log('good job, go to smoke and fuck', result)
      $.each(result.programs, function (i, program) {
      $("select[name='programa']").append($('<option>', { 
          value: program,
          text : program 
          }));
      });

      $.each(result.faculties, function (i, faculty) {
      $("select[name='facultad']").append($('<option>', { 
          value: faculty,
          text : faculty 
          }));
      });
    }
  
    google.script.run.withSuccessHandler(onSuccess).getFacultiesAndPrograms()
  
  }

function searchPersonInSRA(cedula){

}
  
function formValidation() {
    $('.ui.form')
      .form({
        inline: true,
        on: 'blur',
        transition: 'fade down',
        onSuccess: validationpassed,
        fields: {
          nombres: {
            identifier: 'nombres',
            rules: [
              {
                type: 'empty',
                prompt: 'Por favor ingrese un nombre'
              }
            ]
          },
          apellidos: {
            identifier: 'apellidos',
            rules: [
              {
                type: 'empty',
                prompt: 'Por favor ingrese un apellido'
              }
            ]
          },
          cedula: {
            identifier: 'cedula',
            rules: [
              {
                type: 'number',
                prompt: 'Por favor ingrese una cedula valido'
              },
              {
                type: 'empty',
                prompt: 'Por favor ingrese una cedula'
              }
            ]
          },
          celular: {
            identifier: 'celular',
            rules: [
              {
                type: 'number',
                prompt: 'Por favor ingrese un numero valido'
              },
              {
                type: 'empty',
                prompt: 'Por favor ingrese un numero'
              }
            ]
          },
          email: {
            identifier: 'email',
            rules: [
              {
                type: 'email',
                prompt: 'Por favor ingrese a correo valido'
              },
              {
                type: 'empty',
                prompt: 'Por favor ingrese un correo'
              }
            ]
          },
          // programa: {
          //   identifier: 'programa',
          //   rules: [
          //     {
          //       type: 'empty',
          //       prompt: 'Por favor ingrese un programa'
          //     }
          //   ]
          // },
  
          // expedicion: {
          //   identifier: 'expedicion',
          //   rules: [
          //     {
          //       type: 'empty',
          //       prompt: 'Por favor ingrese una expedicion'
          //     }
          //   ]
          // },
          // facultad: {
          //   identifier: 'facultad',
          //   rules: [
          //     {
          //       type: 'empty',
          //       prompt: 'Por favor ingrese una facultad'
          //     }
          //   ]
          // },
        }
      })
  }
  
  
  
  
    </script>